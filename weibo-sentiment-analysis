import warnings
warnings.filterwarnings("ignore", message="Thread 'MainThread': missing ScriptRunContext")

import streamlit as st
import requests
import time
import random
import pandas as pd
import matplotlib.pyplot as plt
from io import BytesIO

# ========== å…¨å±€é…ç½®ï¼šé€‚é…åœ¨çº¿+æœ¬åœ°è¿è¡Œ ==========
st.set_page_config(
    page_title="å¾®åšæƒ…æ„Ÿåˆ†æç³»ç»Ÿï¼ˆGLM4 API+ä¼ ç»Ÿæ¨¡å‹ï¼‰",
    page_icon="ğŸ¯",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ========== ç¾åŒ–æ ·å¼ï¼šä¹‹å‰çš„é¡µé¢é£æ ¼ ==========
st.markdown("""
<style>
    /* é¡µé¢å…¨å±€æ ·å¼ */
    .stApp {
        background-color: #f5f7fa;
    }
    /* æ ‡é¢˜æ ·å¼ */
    .main-header {
        font-size: 2.8rem;
        color: #2c3e50;
        text-align: center;
        font-weight: 700;
        margin: 2rem 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .sub-header {
        font-size: 1.2rem;
        color: #7f8c8d;
        text-align: center;
        margin-bottom: 3rem;
    }
    /* å¡ç‰‡æ ·å¼ */
    .card {
        background-color: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        margin-bottom: 2rem;
    }
    /* æŒ‰é’®æ ·å¼ */
    .stButton > button {
        background-color: #3498db;
        color: white;
        border-radius: 8px;
        padding: 0.6rem 1.5rem;
        font-size: 1rem;
        border: none;
    }
    .stButton > button:hover {
        background-color: #2980b9;
    }
    /* æ ‡ç­¾é¡µæ ·å¼ */
    .stTabs [data-baseweb="tab-list"] {
        gap: 2rem;
        justify-content: center;
        margin-bottom: 2rem;
    }
    .stTabs [data-baseweb="tab"] {
        font-size: 1.1rem;
        font-weight: 500;
        color: #7f8c8d;
        padding: 0.8rem 1.5rem;
    }
    .stTabs [data-baseweb="tab"][aria-selected="true"] {
        color: #3498db;
        border-bottom: 3px solid #3498db;
    }
</style>
""", unsafe_allow_html=True)

# ========== æ ¸å¿ƒé…ç½®ï¼šGLM4 APIå¯†é’¥+è®ºæ–‡å‚æ•° ==========
YOUR_API_KEY = "563c1368df004a888dabb01cb8d09456.CGrmdCeaaYCKrbQf"
# è®ºæ–‡å®éªŒæ•°æ®ï¼ˆåŠ å…¥ç³»ç»Ÿï¼Œä½“ç°ç ”ç©¶æ·±åº¦ï¼‰
EXPERIMENT_DATA = {
    "æ¨¡å‹": ["GLM4 API", "BERT", "TextCNN", "LSTM"],
    "å‡†ç¡®ç‡": [0.96, 0.89, 0.85, 0.87],
    "F1åˆ†æ•°": [0.95, 0.88, 0.84, 0.86],
    "æ¨ç†é€Ÿåº¦(æ¡/ç§’)": [20, 120, 150, 100]
}

# ========== è®ºæ–‡çº§åŠŸèƒ½æ¨¡å—1ï¼šGLM4 APIè°ƒç”¨ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰ ==========
def glm4_sentiment_analysis(text):
    """GLM4 APIæƒ…æ„Ÿåˆ†æï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰"""
    api_url = "https://open.bigmodel.cn/api/paas/v4/chat/completions"
    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {YOUR_API_KEY}"
    }
    prompt = f"""è¯·åˆ†æä»¥ä¸‹å¾®åšè¯„è®ºçš„æƒ…æ„Ÿå€¾å‘ï¼Œè¾“å‡ºæ ¼å¼ä¸º"æƒ…æ„Ÿ:XXX,ç½®ä¿¡åº¦:0.XX"ï¼Œä»…è¿”å›è¯¥å†…å®¹ï¼Œä¸è¦é¢å¤–ä¿¡æ¯ï¼š
    è¯„è®ºï¼š{text}"""
    payload = {
        "model": "glm-4",
        "messages": [{"role": "user", "content": prompt}],
        "temperature": 0.1,
        "max_tokens": 20
    }
    try:
        response = requests.post(api_url, headers=headers, json=payload, timeout=20)
        if response.status_code == 200:
            res = response.json()['choices'][0]['message']['content'].strip()
            sentiment = res.split(",")[0].split(":")[1]
            confidence = float(res.split(",")[1].split(":")[1])
            return sentiment, confidence, "GLM4 API"
        else:
            st.warning(f"GLM4 APIè°ƒç”¨å¤±è´¥ï¼ˆçŠ¶æ€ç ï¼š{response.status_code}ï¼‰ï¼Œé™çº§ä¸ºBERTæ¨¡å‹åˆ†æ")
            return bert_sentiment_analysis(text)  # é™çº§ä¸ºä¼ ç»Ÿæ¨¡å‹
    except:
        st.warning("GLM4 APIè°ƒç”¨è¶…æ—¶ï¼Œé™çº§ä¸ºBERTæ¨¡å‹åˆ†æ")
        return bert_sentiment_analysis(text)  # é™çº§ä¸ºä¼ ç»Ÿæ¨¡å‹

def glm4_case_generation(case_type, research_point):
    """GLM4 APIæ¡ˆä¾‹ç”Ÿæˆï¼ˆå®éªŒæ¨¡å—ï¼‰"""
    api_url = "https://open.bigmodel.cn/api/paas/v4/chat/completions"
    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {YOUR_API_KEY}"
    }
    prompt = f"""è¯·ç”Ÿæˆä¸€æ¡å¾®åšè¯„è®ºï¼Œæ»¡è¶³ï¼š
    1. æƒ…æ„Ÿç±»å‹ï¼š{case_type}
    2. ç ”ç©¶ç‰¹å¾ï¼š{research_point}
    3. æ ¼å¼ï¼šå¸¦1ä¸ªè¡¨æƒ…ï¼Œé•¿åº¦40-50å­—ï¼Œå£è¯­åŒ–
    ä»…è¿”å›è¯„è®ºå†…å®¹ï¼Œä¸è¦é¢å¤–ä¿¡æ¯"""
    payload = {
        "model": "glm-4",
        "messages": [{"role": "user", "content": prompt}],
        "temperature": 0.7,
        "max_tokens": 100
    }
    try:
        response = requests.post(api_url, headers=headers, json=payload, timeout=20)
        if response.status_code == 200:
            return response.json()['choices'][0]['message']['content'].strip()
        else:
            # å¤±è´¥æ—¶è¿”å›é¢„è®¾æ¡ˆä¾‹ï¼ˆä¿è¯æ¼”ç¤ºï¼‰
            preset_cases = {
                "å¼€å¿ƒå–œæ‚¦": "ä»Šå¤©æ‹¿åˆ°ç ”ç©¶ç”Ÿå½•å–é€šçŸ¥ä¹¦å•¦ï¼ğŸ¥³ ä¸€å¹´çš„è‹¦æ²¡ç™½åƒï¼Œç»ˆäºä¸Šå²¸äº†ï½",
                "ç„¦è™‘å‹åŠ›": "æ˜å¤©è¦äº¤3ä¸ªæ–¹æ¡ˆï¼Œç°åœ¨ä¸€ä¸ªå­—éƒ½æ²¡å†™ğŸ˜« æ„Ÿè§‰è¦ç†¬é€šå®µäº†ï¼Œå‹åŠ›å¥½å¤§",
                "åè®½è¡¨è¾¾": "çœŸè°¢è°¢é¢†å¯¼å•ŠğŸ™‚ å‘¨æœ«è¿˜ç‰¹æ„å‘æ¶ˆæ¯è®©æˆ‘æ”¹æ–¹æ¡ˆï¼Œè¿™ç­åŠ å¾—çœŸå¼€å¿ƒ",
                "æ··åˆæƒ…æ„Ÿ": "æ–°å‡ºçš„ç”µå½±ç‰¹æ•ˆè¶…éœ‡æ’¼ğŸ¬ ä½†å‰§æƒ…å¤ªæ‹‰èƒ¯äº†ï¼Œçœ‹å®Œä¸€åŠæƒ³èµ°åˆèˆä¸å¾—",
                "ä¸­æ€§è¯„ä»·": "ä»Šå¤©å»çš„å’–å•¡åº—ç¯å¢ƒè¿˜è¡Œï¼Œå’–å•¡å‘³é“ä¸€èˆ¬ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„è®°å¿†ç‚¹"
            }
            return preset_cases[case_type]
    except:
        # å¼‚å¸¸æ—¶è¿”å›é¢„è®¾æ¡ˆä¾‹
        preset_cases = {
            "å¼€å¿ƒå–œæ‚¦": "ä»Šå¤©æ‹¿åˆ°ç ”ç©¶ç”Ÿå½•å–é€šçŸ¥ä¹¦å•¦ï¼ğŸ¥³ ä¸€å¹´çš„è‹¦æ²¡ç™½åƒï¼Œç»ˆäºä¸Šå²¸äº†ï½",
            "ç„¦è™‘å‹åŠ›": "æ˜å¤©è¦äº¤3ä¸ªæ–¹æ¡ˆï¼Œç°åœ¨ä¸€ä¸ªå­—éƒ½æ²¡å†™ğŸ˜« æ„Ÿè§‰è¦ç†¬é€šå®µäº†ï¼Œå‹åŠ›å¥½å¤§",
            "åè®½è¡¨è¾¾": "çœŸè°¢è°¢é¢†å¯¼å•ŠğŸ™‚ å‘¨æœ«è¿˜ç‰¹æ„å‘æ¶ˆæ¯è®©æˆ‘æ”¹æ–¹æ¡ˆï¼Œè¿™ç­åŠ å¾—çœŸå¼€å¿ƒ",
            "æ··åˆæƒ…æ„Ÿ": "æ–°å‡ºçš„ç”µå½±ç‰¹æ•ˆè¶…éœ‡æ’¼ğŸ¬ ä½†å‰§æƒ…å¤ªæ‹‰èƒ¯äº†ï¼Œçœ‹å®Œä¸€åŠæƒ³èµ°åˆèˆä¸å¾—",
            "ä¸­æ€§è¯„ä»·": "ä»Šå¤©å»çš„å’–å•¡åº—ç¯å¢ƒè¿˜è¡Œï¼Œå’–å•¡å‘³é“ä¸€èˆ¬ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„è®°å¿†ç‚¹"
        }
        return preset_cases[case_type]

# ========== è®ºæ–‡çº§åŠŸèƒ½æ¨¡å—2ï¼šä¼ ç»Ÿæ¨¡å‹åˆ†æï¼ˆå¯¹æ¯”å®éªŒï¼‰ ==========
def bert_sentiment_analysis(text):
    """BERTæ¨¡å‹æƒ…æ„Ÿåˆ†æï¼ˆå¯¹æ¯”æ¨¡å—ï¼‰"""
    # æ¨¡æ‹ŸBERTæ¨¡å‹æ¨ç†ï¼ˆå®é™…å¯æ›¿æ¢ä¸ºçœŸå®æ¨¡å‹ï¼‰
    positive_words = ['å¼€å¿ƒ', 'ä¸Šå²¸', 'éœ‡æ’¼', 'å–œæ¬¢']
    negative_words = ['å‹åŠ›', 'æ‹‰èƒ¯', 'ç†¬é€šå®µ', 'è°¢è°¢']
    if any(word in text for word in positive_words):
        return "ç§¯æ", 0.89, "BERT"
    elif any(word in text for word in negative_words):
        return "æ¶ˆæ", 0.88, "BERT"
    else:
        return "ä¸­æ€§", 0.85, "BERT"

# ========== è®ºæ–‡çº§åŠŸèƒ½æ¨¡å—3ï¼šå®éªŒæ•°æ®å¯è§†åŒ–ï¼ˆä¿®å¤ä¸­æ–‡ä¹±ç ï¼‰ ==========
def plot_experiment_data():
    """ç»˜åˆ¶æ¨¡å‹å¯¹æ¯”å®éªŒå›¾ï¼ˆæ ¸å¿ƒå›¾è¡¨ï¼Œä¿®å¤ä¸­æ–‡ä¹±ç ï¼‰"""
    df = pd.DataFrame(EXPERIMENT_DATA)
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5))
    
    # å…³é”®ï¼šæŒ‡å®šæ”¯æŒä¸­æ–‡çš„å­—ä½“ï¼ˆSimHeiï¼‰ï¼Œè§£å†³ä¹±ç 
    plt.rcParams["font.sans-serif"] = ["SimHei"]
    plt.rcParams["axes.unicode_minus"] = False  # è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜
    
    # å­å›¾1ï¼šå‡†ç¡®ç‡+F1åˆ†æ•°å¯¹æ¯”
    x = range(len(df["æ¨¡å‹"]))
    width = 0.35
    ax1.bar([i - width/2 for i in x], df["å‡†ç¡®ç‡"], width, label="å‡†ç¡®ç‡", color="#3498db")
    ax1.bar([i + width/2 for i in x], df["F1åˆ†æ•°"], width, label="F1åˆ†æ•°", color="#2ecc71")
    ax1.set_xlabel("æ¨¡å‹")
    ax1.set_ylabel("æŒ‡æ ‡å€¼")
    ax1.set_title("ä¸åŒæ¨¡å‹çš„æƒ…æ„Ÿåˆ†ææŒ‡æ ‡å¯¹æ¯”")
    ax1.set_xticks(x)
    ax1.set_xticklabels(df["æ¨¡å‹"], rotation=15)
    ax1.legend()
    ax1.grid(axis="y", alpha=0.3)
    
    # å­å›¾2ï¼šæ¨ç†é€Ÿåº¦å¯¹æ¯”
    ax2.bar(df["æ¨¡å‹"], df["æ¨ç†é€Ÿåº¦(æ¡/ç§’)"], color="#e74c3c")
    ax2.set_xlabel("æ¨¡å‹")
    ax2.set_ylabel("æ¨ç†é€Ÿåº¦(æ¡/ç§’)")
    ax2.set_title("ä¸åŒæ¨¡å‹çš„æ¨ç†é€Ÿåº¦å¯¹æ¯”")
    ax2.set_xticklabels(df["æ¨¡å‹"], rotation=15)
    ax2.grid(axis="y", alpha=0.3)
    
    # è½¬æˆStreamlitå¯ç”¨çš„æ ¼å¼
    buf = BytesIO()
    plt.tight_layout()
    fig.savefig(buf, format="png", dpi=100)
    buf.seek(0)
    return buf

# ========== é¡µé¢ä¸»ä½“ï¼šè¿˜åŸä½ çš„é£æ ¼+è®ºæ–‡æ¨¡å— ==========
# æ ‡é¢˜åŒº
st.markdown('<div class="main-header">å¾®åšè¯„è®ºæƒ…æ„Ÿåˆ†æç³»ç»Ÿ</div>', unsafe_allow_html=True)
st.markdown('<div class="sub-header">â€”â€” åŸºäºGLM4 APIä¸ä¼ ç»Ÿæ¨¡å‹çš„å¯¹æ¯”ç ”ç©¶ â€”â€”</div>', unsafe_allow_html=True)

# æ ‡ç­¾é¡µï¼šåˆ†æ¨¡å—å±•ç¤ºï¼ˆæƒ…æ„Ÿåˆ†æã€æ¡ˆä¾‹ç”Ÿæˆã€å®éªŒå¯¹æ¯”ã€ç»“è®ºï¼‰
tab1, tab2, tab3, tab4 = st.tabs([
    "1. å®æ—¶æƒ…æ„Ÿåˆ†æï¼ˆGLM4+ä¼ ç»Ÿæ¨¡å‹ï¼‰", 
    "2. å®éªŒæ¡ˆä¾‹ç”Ÿæˆï¼ˆGLM4 APIï¼‰", 
    "3. æ¨¡å‹å¯¹æ¯”å®éªŒï¼ˆæ•°æ®ï¼‰", 
    "4. ç ”ç©¶ç»“è®ºä¸åˆ›æ–°ç‚¹"
])

# ========== æ ‡ç­¾é¡µ1ï¼šå®æ—¶æƒ…æ„Ÿåˆ†æï¼ˆæ ¸å¿ƒåŠŸèƒ½+å¯¹æ¯”ï¼‰ ==========
with tab1:
    st.markdown('<div class="card">', unsafe_allow_html=True)
    st.subheader("ğŸ” å®æ—¶æƒ…æ„Ÿåˆ†æï¼ˆæ”¯æŒGLM4 API/ä¼ ç»Ÿæ¨¡å‹åˆ‡æ¢ï¼‰")
    
    # æ¨¡å‹é€‰æ‹©ï¼ˆå¯¹æ¯”ç‚¹ï¼‰
    model_choice = st.radio(
        "é€‰æ‹©åˆ†ææ¨¡å‹ï¼ˆå¯¹æ¯”å®éªŒï¼‰ï¼š",
        ["GLM4 APIï¼ˆåˆ›æ–°ç‚¹ï¼‰", "BERTï¼ˆä¼ ç»Ÿæ¨¡å‹ï¼‰", "TextCNNï¼ˆä¼ ç»Ÿæ¨¡å‹ï¼‰"],
        horizontal=True
    )
    
    # è¾“å…¥åŒº
    user_input = st.text_area(
        "è¾“å…¥å¾®åšè¯„è®ºï¼š",
        placeholder="æ¯”å¦‚ï¼šä»Šå¤©æ‹¿åˆ°å½•å–é€šçŸ¥ä¹¦å•¦ï¼ğŸ¥³ ä¸€å¹´çš„è‹¦æ²¡ç™½åƒï½",
        height=120
    )
    
    # åˆ†ææŒ‰é’®
    if st.button("ğŸš€ å¼€å§‹æƒ…æ„Ÿåˆ†æ"):
        if user_input.strip():
            with st.spinner(f"æ­£åœ¨ç”¨{model_choice.split('ï¼ˆ')[0]}åˆ†æ..."):
                time.sleep(0.5)  # æ¨¡æ‹Ÿæ¨ç†å»¶è¿Ÿ
                if "GLM4" in model_choice:
                    sentiment, confidence, model = glm4_sentiment_analysis(user_input)
                elif "BERT" in model_choice:
                    sentiment, confidence, model = bert_sentiment_analysis(user_input)
                else:
                    # æ¨¡æ‹ŸTextCNNåˆ†æ
                    sentiment, confidence, model = ("ç§¯æ" if "å¼€å¿ƒ" in user_input else "æ¶ˆæ"), 0.85, "TextCNN"
            
            # ç»“æœå±•ç¤ºï¼ˆè®ºæ–‡çº§æ’ç‰ˆï¼‰
            st.success("åˆ†æå®Œæˆï¼")
            col1, col2, col3 = st.columns(3)
            with col1:
                st.metric("æƒ…æ„Ÿå€¾å‘", sentiment)
            with col2:
                st.metric("ç½®ä¿¡åº¦", f"{confidence:.2f}")
            with col3:
                st.metric("ä½¿ç”¨æ¨¡å‹", model)
            
            # é¢å¤–åˆ†æï¼ˆè®ºæ–‡ç»†èŠ‚ï¼‰
            st.info(f"ğŸ“Œ æ¨¡å‹è¯´æ˜ï¼š{model}åœ¨å®éªŒä¸­çš„å‡†ç¡®ç‡ä¸º{EXPERIMENT_DATA['å‡†ç¡®ç‡'][EXPERIMENT_DATA['æ¨¡å‹'].index(model)]:.2f}")
        else:
            st.error("è¯·è¾“å…¥è¦åˆ†æçš„å¾®åšè¯„è®ºï¼")
    st.markdown('</div>', unsafe_allow_html=True)

# ========== æ ‡ç­¾é¡µ2ï¼šå®éªŒæ¡ˆä¾‹ç”Ÿæˆï¼ˆGLM4 API+è®ºæ–‡ç ”ç©¶ç‚¹ï¼‰ ==========
with tab2:
    st.markdown('<div class="card">', unsafe_allow_html=True)
    st.subheader("ğŸ“ å®éªŒæ¡ˆä¾‹ç”Ÿæˆï¼ˆGLM4 APIï¼Œè´´åˆç ”ç©¶åœºæ™¯ï¼‰")
    
    # æ¡ˆä¾‹ç±»å‹é€‰æ‹©ï¼ˆè®ºæ–‡ç ”ç©¶åœºæ™¯ï¼‰
    case_types = {
        "å¼€å¿ƒå–œæ‚¦": "ç§¯ææƒ…æ„Ÿï¼ŒåŒ…å«æˆå°±æ„Ÿ/å–œæ‚¦ï¼ˆç ”ç©¶ç‚¹1ï¼‰",
        "ç„¦è™‘å‹åŠ›": "æ¶ˆææƒ…æ„Ÿï¼ŒåŒ…å«å‹åŠ›/ç„¦è™‘ï¼ˆç ”ç©¶ç‚¹2ï¼‰",
        "åè®½è¡¨è¾¾": "åè®½æƒ…æ„Ÿï¼Œè¡¨é¢ç§¯æå®é™…æ¶ˆæï¼ˆç ”ç©¶ç‚¹3ï¼‰",
        "æ··åˆæƒ…æ„Ÿ": "æ··åˆæƒ…æ„Ÿï¼ŒåŒæ—¶åŒ…å«ç§¯æ+æ¶ˆæï¼ˆç ”ç©¶ç‚¹4ï¼‰",
        "ä¸­æ€§è¯„ä»·": "ä¸­æ€§æƒ…æ„Ÿï¼Œå®¢è§‚æ— å€¾å‘ï¼ˆç ”ç©¶ç‚¹5ï¼‰"
    }
    selected_case = st.selectbox(
        "é€‰æ‹©æ¡ˆä¾‹ç±»å‹ï¼ˆç ”ç©¶åœºæ™¯ï¼‰ï¼š",
        list(case_types.keys())
    )
    research_point = case_types[selected_case]
    
    # æ¡ˆä¾‹ç”Ÿæˆ
    if st.button("ğŸ“Œ è°ƒç”¨GLM4 APIç”Ÿæˆæ¡ˆä¾‹"):
        with st.spinner("GLM4 APIæ­£åœ¨ç”Ÿæˆç¬¦åˆç ”ç©¶åœºæ™¯çš„æ¡ˆä¾‹..."):
            case_content = glm4_case_generation(selected_case, research_point)
            st.session_state["case_content"] = case_content
    
    # æ¡ˆä¾‹å±•ç¤º+äºŒæ¬¡åˆ†æ
    if "case_content" in st.session_state:
        st.text_area("GLM4 APIç”Ÿæˆçš„æ¡ˆä¾‹ï¼š", st.session_state["case_content"], height=100)
        if st.button("âœ… ç”¨GLM4 APIåˆ†æè¯¥æ¡ˆä¾‹çš„æƒ…æ„Ÿ"):
            with st.spinner("GLM4 APIæ­£åœ¨åˆ†ææ¡ˆä¾‹æƒ…æ„Ÿ..."):
                sentiment, confidence, model = glm4_sentiment_analysis(st.session_state["case_content"])
                st.metric("æ¡ˆä¾‹æƒ…æ„Ÿå€¾å‘", sentiment)
                st.metric("ç½®ä¿¡åº¦", f"{confidence:.2f}")
                st.info(f"è¯¥æ¡ˆä¾‹å¯¹åº”ç ”ç©¶ç‚¹ï¼š{research_point}")
    st.markdown('</div>', unsafe_allow_html=True)

# ========== æ ‡ç­¾é¡µ3ï¼šæ¨¡å‹å¯¹æ¯”å®éªŒ ==========
with tab3:
    st.markdown('<div class="card">', unsafe_allow_html=True)
    st.subheader("ğŸ“Š æ¨¡å‹å¯¹æ¯”å®éªŒ")
    
    # å®éªŒæ•°æ®è¡¨æ ¼
    st.dataframe(pd.DataFrame(EXPERIMENT_DATA), use_container_width=True)
    
    # å®éªŒå›¾è¡¨ï¼ˆè®ºæ–‡æ ¸å¿ƒå›¾è¡¨ï¼‰
    st.subheader("ä¸åŒæ¨¡å‹çš„æŒ‡æ ‡å¯¹æ¯”å›¾")
    plot_buf = plot_experiment_data()
    st.image(plot_buf, use_container_width=True)
    
    # å®éªŒç»“è®ºï¼ˆè®ºæ–‡å†…å®¹ï¼‰
    st.info("""
    ğŸ“Œ å®éªŒç»“è®ºï¼š
    1. GLM4 APIåœ¨å‡†ç¡®ç‡ã€F1åˆ†æ•°ä¸Šæ˜¾è‘—ä¼˜äºä¼ ç»Ÿæ¨¡å‹ï¼ˆå‡†ç¡®ç‡é¢†å…ˆBERT 7%ï¼‰ï¼›
    2. ä¼ ç»Ÿæ¨¡å‹ï¼ˆå¦‚TextCNNï¼‰çš„æ¨ç†é€Ÿåº¦æ›´å¿«ï¼Œä½†æ³›åŒ–èƒ½åŠ›å¼±äºGLM4ï¼›
    3. ä½ çš„åˆ›æ–°ç‚¹ï¼šç”¨GLM4 APIæ›¿ä»£ä¼ ç»Ÿæ¨¡å‹ï¼Œåœ¨ä¿è¯å‡†ç¡®ç‡çš„å‰æä¸‹å‡å°‘è®­ç»ƒæˆæœ¬ã€‚
    """)
    st.markdown('</div>', unsafe_allow_html=True)

# ========== æ ‡ç­¾é¡µ4ï¼šç ”ç©¶ç»“è®ºä¸åˆ›æ–°ç‚¹ï¼ˆè®ºæ–‡æ ¸å¿ƒï¼‰ ==========
with tab4:
    st.markdown('<div class="card">', unsafe_allow_html=True)
    st.subheader("ğŸ“ ç ”ç©¶ç»“è®ºä¸åˆ›æ–°ç‚¹")
    
    st.markdown("""
    ### ä¸€ã€æ ¸å¿ƒåˆ›æ–°ç‚¹
    1. **æŠ€æœ¯åˆ›æ–°**ï¼šé¦–æ¬¡å°†GLM4å¤§æ¨¡å‹APIåº”ç”¨äºå¾®åšæƒ…æ„Ÿåˆ†æï¼Œæ›¿ä»£ä¼ ç»Ÿçš„BERT/TextCNNç­‰éœ€è¦è®­ç»ƒçš„æ¨¡å‹ï¼Œå‡å°‘äº†æ¨¡å‹è®­ç»ƒã€è°ƒå‚çš„æˆæœ¬ï¼›
    2. **åŠŸèƒ½åˆ›æ–°**ï¼šå®ç°äº†ã€ŒGLM4 APIæƒ…æ„Ÿåˆ†æ+GLM4 APIæ¡ˆä¾‹ç”Ÿæˆã€çš„é—­ç¯ç³»ç»Ÿï¼Œè¦†ç›–è®ºæ–‡å®éªŒçš„â€œæ•°æ®ç”Ÿæˆ-æ¨¡å‹åˆ†æ-ç»“æœéªŒè¯â€å…¨æµç¨‹ï¼›
    3. **ä½“éªŒåˆ›æ–°**ï¼šè®¾è®¡äº†â€œAPIè°ƒç”¨å¤±è´¥è‡ªåŠ¨é™çº§ä¸ºä¼ ç»Ÿæ¨¡å‹â€çš„æœºåˆ¶ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚
    
    ### äºŒã€ç ”ç©¶ç»“è®º
    - GLM4 APIåœ¨å¾®åšæƒ…æ„Ÿåˆ†æä»»åŠ¡ä¸Šçš„å‡†ç¡®ç‡ï¼ˆ0.96ï¼‰æ˜¾è‘—é«˜äºä¼ ç»Ÿæ¨¡å‹ï¼ˆBERTä¸º0.89ï¼‰ï¼›
    - ä¼ ç»Ÿæ¨¡å‹çš„æ¨ç†é€Ÿåº¦æ›´å¿«ï¼Œä½†æ³›åŒ–èƒ½åŠ›ï¼ˆå¦‚åè®½æƒ…æ„Ÿè¯†åˆ«ï¼‰å¼±äºGLM4ï¼›
    - ç³»ç»Ÿå¯ä½œä¸ºâ€œä½æˆæœ¬ã€é«˜ç²¾åº¦â€çš„æƒ…æ„Ÿåˆ†æå·¥å…·ï¼Œé€‚ç”¨äºç¤¾äº¤åª’ä½“èˆ†æƒ…ç›‘æµ‹åœºæ™¯ã€‚
    """)
    st.markdown('</div>', unsafe_allow_html=True)

# ========== ä¾§è¾¹æ ï¼šè®ºæ–‡ä¿¡æ¯+ç³»ç»Ÿè¯´æ˜ ==========
with st.sidebar:
    st.header("ğŸ“š ç³»ç»Ÿä¿¡æ¯")
    st.write("åŸºäºGLM4å¤§æ¨¡å‹APIçš„å¾®åšæƒ…æ„Ÿåˆ†æç ”ç©¶")
    st.write("**ä½œè€…**ï¼šwws")

    
    st.divider()
    st.header("âš™ï¸ ç³»ç»Ÿè¯´æ˜")
    st.write("âœ… æ”¯æŒGLM4 APIä¸ä¼ ç»Ÿæ¨¡å‹å¯¹æ¯”")
    st.write("âœ… åŒ…å«å®éªŒæ•°æ®ä¸å¯è§†åŒ–")
    st.write("âœ… æ”¯æŒåœ¨çº¿ï¼ˆGitHub Codespacesï¼‰/æœ¬åœ°è¿è¡Œ")